<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="plantilla/template :: head">
</head>
<body class="sb-nav-fixed">

	<header th:replace="plantilla/template :: header"></header>

	<div id="layoutSidenav">

		<div th:replace="plantilla/template :: sidenav_nav"></div>

		<div id="layoutSidenav_content">

			<div class="container-fluid px-4 mt-3">

				<h1 class="">Autorización de Retiro</h1>
				<ol class="breadcrumb mb-4">
					<li class="breadcrumb-item active"><i
						class="fa-solid fa-boxes"></i> Retiro de Material</li>
				</ol>

				<div class="mt-3" id="cardAutorization"></div>

				<div class="card mb-4">
					<div class="card-header">
						<div class="d-md-flex justify-content-between">
							<div><i class="fa-solid fa-table"></i> Listado de Empleados:</div>
							<button class="btn btn-info btn-sm fw-bold" onclick="autorizarRetiroExterno()">Retiro Externo</button>
						</div>
						
					</div>
					<div class="card-body">

						<table id="table_id" class="display">
							<thead>
								<tr>
									<th>Legajo</th>
									<th>Nombre</th>
									<th>Apellido</th>
									<th>Sector de Trabajo</th>
									<th>Autorizar Retiro</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>1</td>
									<td>Emiliano</td>
									<td>Mendoza</td>
									<td>Mantenimiento</td>
									<td>
										<button class="btn btn-info btn-sm fw-bold btn-autorizar">Autorizar</button>
									</td>
								</tr>
								<tr>
									<td>2</td>
									<td>Mariano</td>
									<td>Mendoza</td>
									<td>Guardia</td>
									<td>
										<button class="btn btn-info btn-sm fw-bold btn-autorizar">Autorizar</button>
									</td>
								</tr>

								<tr>
									<td>3</td>
									<td>Celina</td>
									<td>Del Turco</td>
									<td>Secretaria</td>
									<td>
										<button class="btn btn-info btn-sm fw-bold btn-autorizar">Autorizar</button>
									</td>
								</tr>
								
							</tbody>
						</table>

					</div>
				</div>
			</div>
		</div>

	</div>

	<footer th:replace="plantilla/template :: footer"></footer>

	<script type="text/javascript">
		const cardAutorization = document.querySelector('#cardAutorization');
		var datatable;
		
		$(document).ready(function() {
			datatable = $('#table_id').DataTable({
				language : {
					"decimal" : "",
					"emptyTable" : "No hay informaci�n",
					"info" : "Mostrando _START_ a _END_ de _TOTAL_ Empleados",
					"infoEmpty" : "Mostrando 0 to 0 of 0 Entradas",
					"infoFiltered" : "(Filtrado de _MAX_ total entradas)",
					"infoPostFix" : "",
					"thousands" : ",",
					"lengthMenu" : "Mostrar _MENU_ Empleados",
					"loadingRecords" : "Cargando...",
					"processing" : "Procesando...",
					"search" : "Buscar:",
					"zeroRecords" : "Sin resultados encontrados",
					"paginate" : {
						"first" : "Primero",
						"last" : "Ultimo",
						"next" : "Siguiente",
						"previous" : "Anterior"
					}
				},
				"columnDefs" : [ {
					"className" : "dt-center",
					"targets" : "_all"
				} ]
			});

		});
		
		$("#table_id tbody").on("click", '.btn-autorizar', function() {
			let filaSeleccionada = (this).closest("tr");
			let data = datatable.row(filaSeleccionada).data();
			
			console.log(data);
			
			cardAutorization.innerHTML = `
				<div class="card text-dark bg-light mb-3">
					<form id="formAut" method="post">
						<div class="card-header">
							Nueva Autorización:
						</div>
						<div class="card-body">
							
							<p>Empleado autorizado: ${data[1]} ${data[2]}</p>					
								
							<div class="mb-3">
								<label for="exampleInputEmail1" class="form-label">Descripción:</label>
								<textarea class="form-control" id="desc" name="desc"
									rows="2" required></textarea>
							</div>
							<div class="mb-3">
							<label for="materiales" class="form-label">Materiales: </label>
							<small class="text-muted"><span> (Ctrl + click para selección múltiple)</span></small>
							<select class="form-select"
								multiple aria-label="multiple select example" name="materiales"
								id="materiales">
			
							</select>
							</div>
							<div class="">
								<label for="fechaLimite" class="form-label">Fecha Límite:  </label>
								<input type="date" id="fechaLimite" name="fechaLimite"
						       		>
							</div>
							<div>
								<input type="hidden" id="nroLegajo" name="nroLegajo" value="">
							</div>																				
						</div>
						
						<div class="card-footer d-md-flex justify-content-between">
							<button type="button" class="btn btn-secondary " onclick="CloseCard()"
								>Cancelar</button> 
								<input type="submit"
								class="btn btn-secondary " value="Confirmar" />
						</div>	
						
					</form>
				</div>
				`;
				window.scroll(0, 0);
																
		});
			
		function CloseCard(){
			cardAutorization.innerHTML = '';
		}
		
		
		function autorizarRetiroExterno(){
			
			cardAutorization.innerHTML = `
				<div class="card text-dark bg-light mb-3">
					<form id="formAut" method="post">
						<div class="card-header">
							Nueva Autorización:
						</div>
						<div class="card-body">
							
							<p>Retiro Externo</p>					
								
							<div class="mb-3">
								<label for="exampleInputEmail1" class="form-label">Descripción:</label>
								<textarea class="form-control" id="desc" name="desc"
									rows="2" required></textarea>
							</div>
							<div class="mb-3">
							<label for="materiales" class="form-label">Materiales: </label>
							<small class="text-muted"><span> (Ctrl + click para selección múltiple)</span></small>
							<select class="form-select"
								multiple aria-label="multiple select example" name="materiales"
								id="materiales">
			
							</select>
							</div>
							<div class="">
								<label for="fechaLimite" class="form-label">Fecha Límite:  </label>
								<input type="date" id="fechaLimite" name="fechaLimite"
						       		>
							</div>
							<div>
								<input type="hidden" id="nroLegajo" name="nroLegajo" value="">
							</div>																				
						</div>
						
						<div class="card-footer d-md-flex justify-content-between">
							<button type="button" class="btn btn-secondary " onclick="CloseCard()"
								>Cancelar</button> 
								<input type="submit"
								class="btn btn-secondary " value="Confirmar" />
						</div>	
						
					</form>
				</div>
			`;
		}
		
	</script>
</body>
</html>